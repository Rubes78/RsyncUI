
<!DOCTYPE html>
<html>
<head>
  <title>Select Folder</title>
  <style>
    body {
      font-family: sans-serif;
      background: #f4f4f4;
      padding: 20px;
    }
    ul {
      list-style: none;
      padding: 0;
    }
    li {
      padding: 6px;
      background: white;
      margin-bottom: 4px;
      border-radius: 4px;
      cursor: pointer;
      box-shadow: 0 1px 2px rgba(0,0,0,0.1);
    }
    li:hover {
      background: #e0e0e0;
    }
    h2 {
      margin-top: 0;
    }
  </style>
</head>
<body>
  <h2>Select a Folder</h2>
  <ul id="folder-list"></ul>

  <script>
    const params = new URLSearchParams(window.location.search);
    const field = params.get("field");
    let currentPath = "/";

    function fetchFolders(path) {
      fetch("/browse-folder?path=" + encodeURIComponent(path))
        .then(res => res.json())
        .then(data => {
          currentPath = path;
          const list = document.getElementById("folder-list");
          list.innerHTML = "";

          if (path !== "/") {
            const parent = document.createElement("li");
            parent.textContent = ".. (Up one level)";
            parent.onclick = () => {
              const up = path.split("/").filter(p => p).slice(0, -1).join("/");
              fetchFolders("/" + up);
            };
            list.appendChild(parent);
          }

          data.folders.forEach(folder => {
            const li = document.createElement("li");
            li.textContent = folder;
            li.onclick = () => {
              const fullPath = path.endsWith("/") ? path + folder : path + "/" + folder;
              fetchFolders(fullPath);
            };
            list.appendChild(li);
          });

          const confirm = document.createElement("li");
          confirm.textContent = "[ Select This Folder ]";
          confirm.style.fontWeight = "bold";
          confirm.style.color = "#2e7d32";
          confirm.onclick = () => {
            window.opener.document.getElementById(field).value = currentPath;
            window.close();
          };
          list.appendChild(confirm);
        });
    }

    fetchFolders("/");
  </script>
</body>
</html>
